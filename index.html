<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æœ‹å‹çš„AIç»˜ç”»ä¹å›­</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/queue.css">
    <!-- å¼•å…¥å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- æ·»åŠ å­¦ç”Ÿä¿¡æ¯æ˜¾ç¤ºæ ·å¼ -->
    <style>
        .student-info-banner {
            background-color: #f8f9fa;
            color: #333;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid #ddd;
            position: relative;
            z-index: 100;
        }
        .dark-theme .student-info-banner {
            background-color: #2c3e50;
            color: #ecf0f1;
            border-bottom: 1px solid #34495e;
        }
    </style>
    
    <!-- ç™¾åº¦ç¿»è¯‘APIæ”¯æŒ -->
    <script>
        // ç™¾åº¦ç¿»è¯‘APIè¾…åŠ©å‡½æ•°
        window.baiduTranslateHelpers = {
            // å¤‡ç”¨å­—å…¸ç¿»è¯‘ï¼Œå½“APIå¤±è´¥æ—¶ä½¿ç”¨
            dictionary: {
                // å¯¹è±¡/ä¸»ä½“
                "çŒ«": "cat",
                "çŒ«å’ª": "kitten",
                "å°çŒ«": "kitten",
                "ç‹—": "dog",
                "å°ç‹—": "puppy",
                "å¥³å­©": "girl",
                "å°å¥³å­©": "little girl",
                "ç”·å­©": "boy",
                "å°ç”·å­©": "little boy",
                "äºº": "person",
                "å¥³äºº": "woman",
                "ç”·äºº": "man",
                "è€äºº": "elderly person",
                "é±¼": "fish",
                "å°é±¼": "small fish",
                "é¸Ÿ": "bird",
                "å°é¸Ÿ": "small bird",
                "æ ‘": "tree",
                "èŠ±": "flower",
                "è‰": "grass",
                "å±±": "mountain",
                "æ²³": "river",
                "æ¹–": "lake",
                "æµ·": "sea",
                "å¤©ç©º": "sky",
                "äº‘": "cloud",
                "æ˜Ÿæ˜Ÿ": "star",
                "æœˆäº®": "moon",
                "å¤ªé˜³": "sun",
                "æˆ¿å­": "house",
                "åŸå ¡": "castle",
                "æ£®æ—": "forest",
                "åŸå¸‚": "city",
                "æ‘åº„": "village",
                "å®‡å®™é£èˆ¹": "spaceship",
                "ç«ç®­": "rocket",
                "æ±½è½¦": "car",
                "æœºå™¨äºº": "robot"
            }
        };
    </script>
    
    <!-- å¼•å…¥translate.jsç¿»è¯‘åº“ -->
    <script src="https://res.zvo.cn/translate/translate.js"></script>
</head>
<body>
    <!-- æ·»åŠ å­¦ç”Ÿä¿¡æ¯æ˜¾ç¤ºæ¨ªå¹… -->
    <div class="student-info-banner" id="studentInfoBanner">
        æ­£åœ¨è·å–å­¦ç”Ÿä¿¡æ¯...
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- æœºå™¨äººè£…é¥° -->
        <div class="leaves"></div>
        
        <!-- ä¸»å¡ç‰‡ -->
        <div class="card">
            <!-- æ ‡é¢˜ -->
            <h1 class="title">å°æœ‹å‹çš„AIç»˜ç”»ä¹å›­</h1>
            
            <!-- è¡¨å•åŒºåŸŸ -->
            <div class="form-container">
                <!-- æè¿°è¯è¾“å…¥ -->
                <div class="form-group">
                    <label for="prompt">ç”»ä»€ä¹ˆå‘¢:</label>
                    <textarea id="prompt" placeholder="ä¾‹å¦‚ï¼šä¸€åªå¯çˆ±çš„å°ç‹—åœ¨è‰åœ°ä¸Šç©è€ï¼Œæ—è¾¹æœ‰è´è¶åœ¨é£èˆ"></textarea>
                </div>
                <div class="translation-wrapper">
                    <button id="translateBtn" class="btn btn-sm btn-info">ç¿»è¯‘</button>
                    <div id="translationDisplay" class="translation-display"></div>
                </div>
                
                <!-- å°å¸®æ‰‹æç¤ºè¯åŒºåŸŸ - ç§»åŠ¨åˆ°ç¿»è¯‘åŒºåŸŸä¸‹æ–¹ï¼Œç”»ä½œæ¯”ä¾‹ä¸Šæ–¹ -->
                <div class="prompt-helper">
                    <h3>å°å¸®æ‰‹æç¤ºè¯ <span class="helper-subtitle">ğŸ‘‰ ç‚¹å‡»ä¸‹é¢çš„æç¤ºè¯ï¼Œè‡ªåŠ¨å¡«å†™åˆ°"ç”»ä»€ä¹ˆ"æ¡†é‡Œ</span></h3>
                    <div class="prompt-tags-container">
                        <div class="prompt-tag" data-prompt="ä¸€åªå¯çˆ±çš„çŒ«å’ªåœ¨ç©æ¯›çº¿çƒ">ğŸ± çŒ«å’ªç©æ¯›çº¿çƒ</div>
                        <div class="prompt-tag" data-prompt="ä¸€æ¡å½©è‰²çš„å°é±¼åœ¨æµ·åº•æ¸¸æ³³ï¼Œå‘¨å›´æœ‰çŠç‘š">ğŸŸ å½©è‰²å°é±¼æ¸¸æ³³</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªå¡é€šé£æ ¼çš„å®‡èˆªå‘˜åœ¨å¤ªç©ºä¸­æ¼‚æµ®">ğŸ‘¨â€ğŸš€ å®‡èˆªå‘˜å¤ªç©ºæ¼‚æµ®</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªé­”æ³•åŸå ¡ï¼ŒåŸå ¡å‘¨å›´æœ‰å½©è™¹å’Œå°ç²¾çµ">ğŸ° é­”æ³•åŸå ¡å’Œç²¾çµ</div>
                        <div class="prompt-tag" data-prompt="ä¸€åªæé¾™åœ¨æ£®æ—é‡Œåƒæ°´æœ">ğŸ¦• æé¾™åƒæ°´æœ</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªå°å¥³å­©åœ¨é›ªåœ°é‡Œå †é›ªäºº">â›„ å°å¥³å­©å †é›ªäºº</div>
                        <div class="prompt-tag" data-prompt="ä¸€è‰˜å®‡å®™é£èˆ¹åœ¨æ˜Ÿç³»ä¸­èˆªè¡Œ">ğŸš€ å®‡å®™é£èˆ¹èˆªè¡Œ</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªçƒ­æ°”çƒé£è¶Šå±±è„‰ï¼Œå±±ä¸‹æœ‰å°æ‘åº„">ğŸˆ çƒ­æ°”çƒé£è¡Œ</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªæœºå™¨äººåœ¨ç©è¶³çƒ">ğŸ¤– æœºå™¨äººè¸¢è¶³çƒ</div>
                        <div class="prompt-tag" data-prompt="ä¸€åº§æ°´ä¸‹åŸå¸‚ï¼Œæœ‰é±¼å„¿å’Œç¾äººé±¼">ğŸ§œâ€â™€ï¸ æ°´ä¸‹åŸå¸‚</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªç«¥è¯æ£®æ—ï¼Œæœ‰è˜‘è‡æˆ¿å­å’Œå°åŠ¨ç‰©">ğŸ„ ç«¥è¯æ£®æ—</div>
                        <div class="prompt-tag" data-prompt="ä¸€åªå°ç‹—åœ¨æµ·æ»©ä¸Šç©æ²™å­">ğŸ• å°ç‹—ç©æ²™å­</div>
                        <div class="prompt-tag" data-prompt="ä¸€æ¡ä¸ƒå½©çš„é¾™åœ¨äº‘ä¸­é£ç¿”">ğŸ‰ ä¸ƒå½©é¾™é£ç¿”</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªè¶…çº§è‹±é›„åœ¨åŸå¸‚ä¸­é£è¡Œ">ğŸ¦¸ è¶…çº§è‹±é›„é£è¡Œ</div>
                        <div class="prompt-tag" data-prompt="ä¸€ä¸ªå·¨å¤§çš„ç³–æœåŸå ¡ï¼Œæœ‰å·§å…‹åŠ›æ²³æµ">ğŸ­ ç³–æœåŸå ¡</div>
                        <div class="prompt-tag" data-prompt="ä¸€ç¾¤ä¼é¹…åœ¨å†°å±±ä¸Šæ»‘æ»‘æ¢¯">ğŸ§ ä¼é¹…æ»‘å†°å±±</div>
                    </div>
                </div>
                
                <!-- æ¯”ä¾‹é€‰æ‹©å™¨ -->
                <div class="form-group">
                    <label>ç”»ä½œæ¯”ä¾‹:</label>
                    <div class="aspect-ratio-selector">
                        <input type="radio" id="ratio1_1" name="aspectRatio" value="1:1" checked>
                        <label for="ratio1_1" class="ratio-option" title="1:1 æ–¹å½¢">
                            <div class="ratio-icon ratio-1-1"></div>
                            <span>1:1</span>
                        </label>
                        
                        <input type="radio" id="ratio1_2" name="aspectRatio" value="1:2">
                        <label for="ratio1_2" class="ratio-option" title="1:2 ç«–é•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-1-2"></div>
                            <span>1:2</span>
                        </label>
                        
                        <input type="radio" id="ratio2_1" name="aspectRatio" value="2:1">
                        <label for="ratio2_1" class="ratio-option" title="2:1 æ¨ªé•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-2-1"></div>
                            <span>2:1</span>
                        </label>
                        
                        <input type="radio" id="ratio2_3" name="aspectRatio" value="2:3">
                        <label for="ratio2_3" class="ratio-option" title="2:3 ç«–é•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-2-3"></div>
                            <span>2:3</span>
                        </label>
                        
                        <input type="radio" id="ratio3_2" name="aspectRatio" value="3:2">
                        <label for="ratio3_2" class="ratio-option" title="3:2 æ¨ªé•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-3-2"></div>
                            <span>3:2</span>
                        </label>
                        
                        <input type="radio" id="ratio3_4" name="aspectRatio" value="3:4">
                        <label for="ratio3_4" class="ratio-option" title="3:4 ç«–é•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-3-4"></div>
                            <span>3:4</span>
                        </label>
                        
                        <input type="radio" id="ratio4_3" name="aspectRatio" value="4:3">
                        <label for="ratio4_3" class="ratio-option" title="4:3 æ¨ªé•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-4-3"></div>
                            <span>4:3</span>
                        </label>
                        
                        <input type="radio" id="ratio9_16" name="aspectRatio" value="9:16">
                        <label for="ratio9_16" class="ratio-option" title="9:16 ç«–é•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-9-16"></div>
                            <span>9:16</span>
                        </label>
                        
                        <input type="radio" id="ratio16_9" name="aspectRatio" value="16:9">
                        <label for="ratio16_9" class="ratio-option" title="16:9 æ¨ªé•¿æ–¹å½¢">
                            <div class="ratio-icon ratio-16-9"></div>
                            <span>16:9</span>
                        </label>
                    </div>
                </div>
                
                <!-- å°ºå¯¸æ˜¾ç¤ºåŒºåŸŸï¼ˆåªè¯»å±•ç¤ºï¼‰ -->
                <div class="form-group" style="display:none">
                    <label>å®é™…å°ºå¯¸:</label>
                    <div class="size-display">
                        <span id="actualSize">1440 Ã— 1440 åƒç´ </span>
                    </div>
                    <!-- éšè—çš„è¾“å…¥æ¡†ç”¨äºå­˜å‚¨å®é™…è®¡ç®—åçš„å®½åº¦å’Œé«˜åº¦å€¼ -->
                    <input type="hidden" id="width" value="1440">
                    <input type="hidden" id="height" value="1440">
                </div>
                
                <!-- éšæœºç§å­è¾“å…¥ -->
                <div class="form-group" style="display:none">
                    <label for="seed">ç¥å¥‡æ•°å­—:</label>
                    <input type="number" id="seed" value="101">
                </div>
                
                <!-- å›¾ç‰‡æ ¼å¼é€‰æ‹© -->
                <div class="form-group" style="display:none">
                    <label for="format">å›¾ç‰‡ç±»å‹:</label>
                    <select id="format">
                        <option value="jpeg">JPEGå›¾ç‰‡</option>
                        <option value="png" selected>PNGå›¾ç‰‡</option>
                        <option value="webp">WEBPå›¾ç‰‡</option>
                    </select>
                </div>
            </div>
            
            <!-- é£æ ¼é€‰æ‹©å™¨ -->
            <div class="style-selector">
                <h3>é€‰æ‹©ç»˜ç”»é£æ ¼ <span class="helper-subtitle">ğŸ‘‰ ç‚¹å‡»é€‰æ‹©ä½ å–œæ¬¢çš„ç”»é£</span></h3>
                <div class="style-categories">
                    <!-- åˆå¹¶æ‰€æœ‰é£æ ¼é€‰é¡¹ï¼Œä¸å†åˆ†ç±» -->
                    <div class="style-category">
                        <div class="style-options">
                            <label class="style-tag">
                                <input type="radio" name="style" value="photorealistic" data-prompt="photorealistic, highly detailed photograph, sharp focus">
                                <span>ğŸ“¸ æ‘„å½±å†™å®</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="hyperrealistic" data-prompt="hyperrealistic, extremely detailed, ultra-sharp, 8k resolution">
                                <span>ğŸ” è¶…å†™å®</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="portrait" data-prompt="realistic portrait photography, professional lighting, detailed facial features">
                                <span>ğŸ‘¤ äººåƒå†™å®</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="macro" data-prompt="macro photography, extreme close-up, shallow depth of field, fine details, high resolution, natural lighting">
                                <span>ğŸŒ± å¾®è·æ‘„å½±</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="ghibli" data-prompt="Studio Ghibli style, Miyazaki inspired, fantasy, detailed, soft lighting" checked>
                                <span>âœ¨ å‰åœåŠ›é£æ ¼</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="oil" data-prompt="oil painting, textured brushstrokes, canvas texture, rich colors">
                                <span>ğŸ¨ æ²¹ç”»é£æ ¼</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="watercolor" data-prompt="watercolor painting, flowing colors, wet on wet, soft edges">
                                <span>ğŸ’¦ æ°´å½©ç”»é£</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="ink" data-prompt="traditional Chinese ink painting, brush and ink, minimal, elegant">
                                <span>ğŸ–Œï¸ æ°´å¢¨ç”»é£</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="anime" data-prompt="anime style, vibrant colors, clean lines, Japanese animation">
                                <span>ğŸŒ¸ äºŒæ¬¡å…ƒåŠ¨æ¼«</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="cartoon" data-prompt="cartoon style, flat colors, simple shapes, clean outlines">
                                <span>ğŸ“º å¡é€šå¹³é¢</span>
                            </label>
                            <label class="style-tag">
                                <input type="radio" name="style" value="pixel" data-prompt="pixel art, 8-bit style, retro game aesthetics, blocky">
                                <span>ğŸ‘¾ åƒç´ è‰ºæœ¯</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æŒ‰é’®åŒºåŸŸ -->
            <div class="button-group">
                <button id="generate" class="btn btn-primary">å¼€å§‹ç”»ç”»!</button>
                <button id="download" class="btn btn-success">ä¿å­˜åˆ°æ¡Œé¢</button>
                <button id="toggleTheme" class="btn btn-warning">åˆ‡æ¢å¤œé—´æ¨¡å¼</button>
                <button id="showHelp" class="btn btn-info">å°å¸®æ‰‹</button>
                <a href="gallery.html" class="btn btn-info">å…¨æ ¡ç”»å»Š</a>
            </div>
            
            <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
            <div class="preview-container">
                <h2 class="preview-title">ä½ çš„ç”»ä½œå°†å‡ºç°åœ¨è¿™é‡Œ</h2>
                <div class="image-container">
                    <img id="previewImage" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMDAgMjAwIiBmaWxsPSJub25lIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImJnIiB4MT0iMCIgeTE9IjAiIHgyPSIzMDAiIHkyPSIyMDAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNlN2Y1ZmYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmMGY5ZmYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0idXJsKCNiZykiIHJ4PSIxMCIgcnk9IjEwIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMjAiIGZpbGw9IiM3NGMwZmMiIG9wYWNpdHk9IjAuNyIvPjxjaXJjbGUgY3g9IjI1MCIgY3k9IjE2MCIgcj0iMjUiIGZpbGw9IiM1MWNmNjYiIG9wYWNpdHk9IjAuNSIvPjxjaXJjbGUgY3g9IjI2MCIgY3k9IjMwIiByPSIxNSIgZmlsbD0iI2ZmYTk0ZCIgb3BhY2l0eT0iMC42Ii8+PHBhdGggZD0iTTgwLDgwIEMxMDAsNjAgMTQwLDkwIDE2MCw3MCBTMjAwLDkwIDIyMCw4MCIgc3Ryb2tlPSIjNGRhYmY3IiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWRhc2hhcnJheT0iMSwzIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQ1LCAxMDApIHJvdGF0ZSgtMTApIj48cGF0aCBkPSJNLTMwLC0yMCBoNjAgdjQwIGgtNjAgeiIgZmlsbD0id2hpdGUiIHJ4PSI1IiByeT0iNSIgc3Ryb2tlPSIjNGRhYmY3IiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSIwIiB5PSI3IiBmb250LWZhbWlseT0iJ05vdG8gU2FucyBTQycsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSI2MDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM0ZGFiZjciPuWRiuivtEFJ5L2g5oOz55S75LuA5LmOPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE4IiBmb250LWZhbWlseT0iJ05vdG8gU2FucyBTQycsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iOSIgZm9udC13ZWlnaHQ9IjUwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzZjNzU3ZCI+54S25ZCO54K55Ye75LqGIOW8gOWni+eUu+e7hyDmjInpkq48L3RleHQ+PC9nPjxwYXRoIGQ9Ik03MCwxNDAgUTEwMCwxNzAgMTMwLDE0MCBUMTkwLDE1MCIgc3Ryb2tlPSIjNTFjZjY2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDU1LDQwKSI+PHBhdGggZD0iTTAsLTEwIEw1LC0xNSBMOCwtNSBMMTgsLTggTDE1LDIgTDI1LDUgTDE1LDggTDE4LDE4IEw4LDE1IEw1LDI1IEwwLDE1IEwtNSwyNSBMLTgsMTUgTC0xOCwxOCBMLTE1LDggTC0yNSw1IEwtMTUsMiBMLTE4LC04IEwtOCwtNSBMLTUsLTE1IFoiIGZpbGw9IiNmZmE5NGQiIG9wYWNpdHk9IjAuOSIvPjwvZz48cGF0aCBkPSJNMjEwLDUwIEwyNDAsNDAgTDIzMCw3MCBMMjYwLDYwIEwyNDAsOTAgTDI3MCw4MCBMMjUwLDExMCIgc3Ryb2tlPSIjNTE5OGZmIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==" alt="ä½ çš„ç”»ä½œå°†å‡ºç°åœ¨è¿™é‡Œ">
                    
                    <!-- åŠ è½½ä¸­æç¤º - ç§»åˆ°å›¾ç‰‡å®¹å™¨å†… -->
                    <div id="loading" class="loading-container hidden">
                        <div class="spinner"></div>
                        <p>AIæ­£åœ¨è®¤çœŸç”»ç”»ä¸­ï¼Œè¯·ç¨ç­‰...</p>
                    </div>
                    
                    <!-- è´´çº¸ç¼–è¾‘å±‚ -->
                    <div id="stickerCanvas" class="sticker-canvas"></div>
                    
                    <!-- é˜Ÿåˆ—çŠ¶æ€æ˜¾ç¤º -->
                    <div id="queueStatus" class="queue-status hidden">
                        <div class="queue-icon">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 5H9V3H15V5Z" fill="currentColor" />
                                <path d="M13 9H11V15H13V9Z" fill="currentColor" />
                                <path d="M12 22C6.477 22 2 17.523 2 12C2 6.477 6.477 2 12 2C17.523 2 22 6.477 22 12C22 17.523 17.523 22 12 22ZM12 20C16.418 20 20 16.418 20 12C20 7.582 16.418 4 12 4C7.582 4 4 7.582 4 12C4 16.418 7.582 20 12 20Z" fill="currentColor" />
                            </svg>
                        </div>
                        <div class="queue-position">æ’é˜Ÿä¸­: <span id="positionNumber">-</span></div>
                        <div class="queue-total">æ€»å…±æœ‰ <span id="totalQueue">-</span> ä½å°æœ‹å‹åœ¨æ’é˜Ÿ</div>
                        <div class="queue-progress">
                            <div id="queueProgressBar" class="queue-progress-bar" style="width: 0%;"></div>
                        </div>
                        <div class="queue-message">AIè€å¸ˆæ­£åœ¨ä¸€ä¸ªä¸€ä¸ªç”»ç”»ï¼Œè¯·ç¨ç­‰ä¸€ä¸‹å“¦ï½ <span class="queue-pulse"></span></div>
                    </div>
                </div>
                
                <!-- è´´çº¸å·¥å…·æ  -->
                <div class="sticker-toolbar">
                    <h3>æ·»åŠ è´´çº¸è®©ç”»ä½œæ›´æœ‰è¶£ï¼</h3>
                    <div class="sticker-container">
                        <div class="sticker" data-sticker="ğŸŒˆ"><span>ğŸŒˆ</span></div>
                        <div class="sticker" data-sticker="ğŸŒŸ"><span>ğŸŒŸ</span></div>
                        <div class="sticker" data-sticker="ğŸ¦„"><span>ğŸ¦„</span></div>
                        <div class="sticker" data-sticker="ğŸ¦–"><span>ğŸ¦–</span></div>
                        <div class="sticker" data-sticker="ğŸš€"><span>ğŸš€</span></div>
                        <div class="sticker" data-sticker="ğŸ¨"><span>ğŸ¨</span></div>
                        <div class="sticker" data-sticker="ğŸ®"><span>ğŸ®</span></div>
                        <div class="sticker" data-sticker="ğŸ†"><span>ğŸ†</span></div>
                        <div class="sticker" data-sticker="ğŸ±"><span>ğŸ±</span></div>
                        <div class="sticker" data-sticker="ğŸ¶"><span>ğŸ¶</span></div>
                        <div class="sticker" data-sticker="ğŸ¦"><span>ğŸ¦</span></div>
                        <div class="sticker" data-sticker="ğŸ­"><span>ğŸ­</span></div>
                        <div class="sticker" data-sticker="â¤ï¸"><span>â¤ï¸</span></div>
                        <div class="sticker" data-sticker="ğŸ˜Š"><span>ğŸ˜Š</span></div>
                        <div class="sticker" data-sticker="ğŸ‘"><span>ğŸ‘</span></div>
                        <div class="sticker" data-sticker="ğŸ"><span>ğŸ</span></div>
                    </div>
                    <div class="sticker-controls">
                        <button id="clearStickers" class="btn btn-warning btn-sm">æ¸…é™¤è´´çº¸</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç”»å»Šå±•ç¤ºåŒºåŸŸ -->
        <div class="gallery-section">
            <h2 class="section-title">æˆ‘çš„ç”»å»Š</h2>
            <div id="emptyGallery" class="empty-gallery hidden">
                <img src="images/empty-gallery.svg" alt="ç©ºç”»å»Š">
                <p>ä½ çš„ç”»å»Šè¿˜æ˜¯ç©ºçš„ï¼Œç”Ÿæˆçš„å›¾ç‰‡ä¼šè‡ªåŠ¨ä¿å­˜åœ¨è¿™é‡Œ</p>
            </div>
            <div id="galleryItems" class="gallery-grid">
                <!-- ç”»å»Šé¡¹ä¼šåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
        
        <!-- ç”»å»Šæ“ä½œæŒ‰é’® -->
        <div class="button-group">
            <button id="clearGallery" class="btn btn-warning">æ¸…ç©ºç”»å»Š</button>
        </div>
        
        <!-- é¡µè„š -->
        <footer>
            <p>Â© 2025 å°æœ‹å‹çš„AIç»˜ç”»ä¹å›­ - å¿«ä¹åˆ›ä½œæ¯ä¸€å¤©</p>
        </footer>
    </div>

    <!-- å¸®åŠ©æŒ‡å—å¯¹è¯æ¡† -->
    <div id="helpGuide" class="modal hidden">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>å°æœ‹å‹ç”»ç”»æŒ‡å—</h2>
            <div class="help-steps">
                <div class="help-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>å‘Šè¯‰AIä½ æƒ³ç”»ä»€ä¹ˆ</h3>
                        <p>åœ¨"ç”»ä»€ä¹ˆå‘¢"çš„æ¡†æ¡†é‡Œå†™ä¸‹ä½ æƒ³ç”»çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼š"ä¸€åªå°ç‹—åœ¨è‰åœ°ä¸Šç©è€"</p>
                    </div>
                </div>
                <div class="help-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>é€‰æ‹©ç”»ä½œæ¯”ä¾‹</h3>
                        <p>é€‰æ‹©ä½ æƒ³è¦çš„ç”»ä½œæ¯”ä¾‹ï¼Œæ¯”å¦‚æ­£æ–¹å½¢ï¼ˆ1:1ï¼‰æˆ–è€…é•¿æ–¹å½¢ï¼ˆ16:9ï¼‰</p>
                    </div>
                </div>
                <div class="help-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>ç‚¹å‡»"å¼€å§‹ç”»ç”»"</h3>
                        <p>ç„¶åç­‰ä¸€å°ä¼šå„¿ï¼ŒAIå°±ä¼šå¸®ä½ ç”»å‡ºæ¥å•¦ï¼</p>
                    </div>
                </div>
                <div class="help-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>ä¿å­˜ä½ çš„ç”»ä½œ</h3>
                        <p>å¦‚æœä½ å–œæ¬¢è¿™å¹…ç”»ï¼Œç‚¹å‡»"ä¿å­˜åˆ°æ¡Œé¢"æŒ‰é’®å°±å¯ä»¥å°†ç”»ä½œä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·ä½ éšæ—¶éƒ½èƒ½æ‰¾åˆ°å®ƒï¼</p>
                    </div>
                </div>
            </div>
            <button id="closeHelp" class="btn btn-primary">æˆ‘çŸ¥é“å•¦ï¼</button>
        </div>
    </div>

    <!-- è„šæœ¬é”™è¯¯å¤„ç† -->
    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('å…¨å±€JSé”™è¯¯:', message, source, lineno, colno, error);
            alert('é¡µé¢å‡ºç°é—®é¢˜ï¼Œè¯·åˆ·æ–°åå†è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚');
            return true;
        };
        
        // è„šæœ¬åŠ è½½é”™è¯¯å¤„ç†
        function handleScriptError(scriptSrc) {
            console.error('è„šæœ¬åŠ è½½å¤±è´¥:', scriptSrc);
        }
    </script>

    <!-- æŒ‰é¡ºåºåŠ è½½JSï¼Œæ·»åŠ é”™è¯¯å¤„ç† -->
    <script src="js/client.js" onerror="handleScriptError('client.js')"></script>
    <script src="js/main.js" onerror="handleScriptError('main.js')"></script>
    <script src="js/queue.js" onerror="handleScriptError('queue.js')"></script>
    <script src="js/main-queue.js" onerror="handleScriptError('main-queue.js')"></script>
    <script src="js/gallery.js" onerror="handleScriptError('gallery.js')"></script>
    <script src="js/stickers.js" onerror="handleScriptError('stickers.js')"></script>
    <script src="js/sensitive-words.js" onerror="handleScriptError('sensitive-words.js')"></script>
    
    <!-- æ·»åŠ ç”¨æˆ·ä¿¡æ¯è·å–è„šæœ¬ -->
    <script>
        // å­¦ç”Ÿä¿¡æ¯è·å–é…ç½®
        const STUDENT_INFO_URLS = [
            'http://172.16.201.191/ai/user_extractor.html',
            'http://xxpt.bsd.cn/ai/user_extractor.html'
        ];
        
        // æ›´æ–°å­¦ç”Ÿä¿¡æ¯æ¨ªå¹…
        function updateStudentInfoBanner(studentName, studentId) {
            const banner = document.getElementById('studentInfoBanner');
            if (!banner) return;
            
            if (studentName && studentId) {
                banner.innerHTML = `å½“å‰ç”¨æˆ·: <strong>${studentName}</strong> (å­¦å·: <strong>${studentId}</strong>)`;
                banner.style.backgroundColor = '#d4edda';
                banner.style.color = '#155724';
            } else {
                banner.innerHTML = `æœªè·å–åˆ°ç”¨æˆ·ä¿¡æ¯ <small>(IP: ${window.location.hostname})</small>`;
                banner.style.backgroundColor = '#f8d7da';
                banner.style.color = '#721c24';
            }
        }
        
        // ä»æŒ‡å®šURLè·å–å­¦ç”Ÿä¿¡æ¯çš„å‡½æ•°
        async function fetchStudentInfoFromUrl(url) {
            return new Promise((resolve, reject) => {
                try {
                    console.log(`å°è¯•ä» ${url} è·å–å­¦ç”Ÿä¿¡æ¯`);
                    
                    // åˆ›å»ºiframeæ¥åŠ è½½æå–å™¨é¡µé¢
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = url;
                    document.body.appendChild(iframe);
                    
                    // è®¾ç½®è¶…æ—¶ï¼ˆ8ç§’ï¼‰
                    const timeoutId = setTimeout(() => {
                        try {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        } catch(e) {}
                        reject(new Error(`è·å–å­¦ç”Ÿä¿¡æ¯è¶…æ—¶ (${url})`));
                    }, 8000);
                    
                    // è§£ææºåŸŸå
                    let sourceOrigin = '';
                    try {
                        sourceOrigin = new URL(url).origin;
                    } catch(e) {
                        console.warn(`æ— æ³•è§£æURL origin: ${url}`, e);
                    }
                    
                    // ç›‘å¬æ¶ˆæ¯
                    function handleMessage(event) {
                        // æ£€æŸ¥æ¶ˆæ¯æ¥æºå’Œæ•°æ®
                        if (event.data && (event.data.studentName || event.data.studentId)) {
                            // åªæœ‰å½“æ¶ˆæ¯ä¸­åŒ…å«å­¦ç”Ÿä¿¡æ¯æ—¶æ‰å¤„ç†
                            clearTimeout(timeoutId);
                            window.removeEventListener('message', handleMessage);
                            
                            try {
                                if (document.body.contains(iframe)) {
                                    document.body.removeChild(iframe);
                                }
                            } catch(e) {}
                            
                            const studentInfo = {
                                username: event.data.studentName || '',
                                studentId: event.data.studentId || ''
                            };
                            
                            console.log(`ä» ${url} è·å–åˆ°å­¦ç”Ÿä¿¡æ¯:`, studentInfo);
                            resolve(studentInfo);
                        }
                    }
                    
                    window.addEventListener('message', handleMessage);
                    
                    // iframeåŠ è½½å®Œæˆåçš„å¤„ç†
                    iframe.onload = function() {
                        // ç­‰å¾…2ç§’åä¸»åŠ¨è¯·æ±‚ä¿¡æ¯
                        setTimeout(() => {
                            try {
                                if (iframe.contentWindow) {
                                    console.log(`ä¸»åŠ¨å‘ ${url} è¯·æ±‚å­¦ç”Ÿä¿¡æ¯`);
                                    iframe.contentWindow.postMessage({ type: 'GET_STUDENT_INFO' }, '*');
                                }
                            } catch (e) {
                                console.error(`å‘ ${url} è¯·æ±‚ä¿¡æ¯å¤±è´¥:`, e);
                            }
                        }, 2000);
                    };
                    
                    // å¤„ç†iframeåŠ è½½å¤±è´¥
                    iframe.onerror = function() {
                        clearTimeout(timeoutId);
                        window.removeEventListener('message', handleMessage);
                        try {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        } catch(e) {}
                        reject(new Error(`åŠ è½½å­¦ç”Ÿä¿¡æ¯é¡µé¢å¤±è´¥ (${url})`));
                    };
                } catch (error) {
                    console.error(`åˆ›å»ºiframeæ—¶å‡ºé”™ (${url}):`, error);
                    reject(error);
                }
            });
        }
        
        // å­¦ç”Ÿä¿¡æ¯è·å–å‡½æ•° - å°è¯•æ‰€æœ‰URL
        async function fetchStudentInfo(forceRefresh = false) {
            console.log('å¼€å§‹è·å–å­¦ç”Ÿä¿¡æ¯', forceRefresh ? '(å¼ºåˆ¶åˆ·æ–°)' : '');
            
            // é¦–å…ˆæ£€æŸ¥localStorageä¸­æ˜¯å¦å·²æœ‰å­¦ç”Ÿä¿¡æ¯
            const storedName = localStorage.getItem('username');
            const storedId = localStorage.getItem('studentId');
            const lastUpdateTime = localStorage.getItem('lastInfoUpdate');
            
            // è·å–å½“å‰æ—¶é—´
            const now = new Date().getTime();
            // é™ä½ç¼“å­˜æ—¶é—´åˆ°1åˆ†é’Ÿï¼Œç¡®ä¿æ›´å¿«è·å–æ–°ç”¨æˆ·
            const cacheExpiryTime = 1 * 60 * 1000; // 1åˆ†é’Ÿç¼“å­˜
            
            // åªæœ‰åœ¨éå¼ºåˆ¶åˆ·æ–°æ¨¡å¼ä¸‹ä¸”ç¼“å­˜æ—¶é—´æœ‰æ•ˆæ—¶æ‰ä½¿ç”¨ç¼“å­˜
            if (!forceRefresh && storedName && storedId && lastUpdateTime && (now - parseInt(lastUpdateTime)) < cacheExpiryTime) {
                console.log(`ä½¿ç”¨å·²å­˜å‚¨çš„å­¦ç”Ÿä¿¡æ¯: ${storedName} (${storedId})`);
                updateStudentInfoBanner(storedName, storedId);
                
                // å³ä¾¿ä½¿ç”¨ç¼“å­˜ï¼Œä¹Ÿåœ¨åå°å°è¯•æ›´æ–° - è¿™æ ·ç¬¬ä¸€æ¬¡æ˜¾ç¤ºå¿«ï¼Œåé¢å¦‚æœæœ‰å˜æ›´ä¹Ÿèƒ½æ›´æ–°
                setTimeout(() => refreshStudentInfo(), 100);
                
                return { username: storedName, studentId: storedId };
            }
            
            // å°è¯•ä»æ‰€æœ‰URLè·å–å­¦ç”Ÿä¿¡æ¯
            return await refreshStudentInfo();
        }
        
        // ä»è¿œç¨‹åˆ·æ–°å­¦ç”Ÿä¿¡æ¯
        async function refreshStudentInfo() {
            let lastError = null;
            
            for (const url of STUDENT_INFO_URLS) {
                try {
                    const info = await fetchStudentInfoFromUrl(url);
                    
                    if (info.username && info.studentId) {
                        const storedName = localStorage.getItem('username');
                        const storedId = localStorage.getItem('studentId');
                        
                        // æ£€æŸ¥æ˜¯å¦ä¸å­˜å‚¨çš„ä¿¡æ¯ä¸åŒï¼ˆè¡¨æ˜ç”¨æˆ·å·²æ›´æ”¹ï¼‰
                        if (info.username !== storedName || info.studentId !== storedId) {
                            console.log(`æ£€æµ‹åˆ°ç”¨æˆ·å˜æ›´: ${storedName || 'æ— '} -> ${info.username}`);
                        }
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('username', info.username);
                        localStorage.setItem('studentId', info.studentId);
                        localStorage.setItem('lastInfoUpdate', new Date().getTime().toString());
                        
                        updateStudentInfoBanner(info.username, info.studentId);
                        return info;
                    }
                } catch (error) {
                    console.warn(`ä» ${url} è·å–å­¦ç”Ÿä¿¡æ¯å¤±è´¥:`, error);
                    lastError = error;
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªURL
                }
            }
            
            // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œä½†æœ‰å­˜å‚¨çš„ä¿¡æ¯ï¼Œä½œä¸ºå¤‡ç”¨è¿”å›
            const storedName = localStorage.getItem('username');
            const storedId = localStorage.getItem('studentId');
            
            if (storedName && storedId) {
                console.log(`è·å–æ–°ä¿¡æ¯å¤±è´¥ï¼Œä½¿ç”¨å·²å­˜å‚¨çš„ä¿¡æ¯: ${storedName} (${storedId})`);
                updateStudentInfoBanner(storedName, storedId);
                return { username: storedName, studentId: storedId };
            }
            
            // çœŸçš„æ²¡æœ‰ä¿¡æ¯äº†
            console.error('æ‰€æœ‰URLéƒ½æ— æ³•è·å–å­¦ç”Ÿä¿¡æ¯', lastError);
            updateStudentInfoBanner(null, null);
            return { username: null, studentId: null };
        }
        
        // ä¿®æ”¹ç”ŸæˆæŒ‰é’®ç‚¹å‡»å¤„ç†å‡½æ•°ï¼Œç¡®ä¿å…ˆæ£€æŸ¥ç”¨æˆ·çŠ¶æ€
        async function setupGenerateButton() {
            console.log('æ­£åœ¨è®¾ç½®ç”ŸæˆæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶...');
            const generateButton = document.getElementById('generate');
            if (!generateButton) {
                console.error('æ‰¾ä¸åˆ°ç”ŸæˆæŒ‰é’®');
                return;
            }
            
            // ç§»é™¤åŸå§‹äº‹ä»¶ç›‘å¬ï¼Œé¿å…åŒé‡è§¦å‘
            generateButton.replaceWith(generateButton.cloneNode(true));
            // é‡æ–°è·å–æ–°çš„æŒ‰é’®å…ƒç´ ï¼ˆå› ä¸ºcloneNodeååŸå¼•ç”¨å¤±æ•ˆï¼‰
            const newGenerateButton = document.getElementById('generate');
            
            // è®¾ç½®æ–°çš„ç‚¹å‡»äº‹ä»¶
            newGenerateButton.onclick = async function(event) {
                // é˜»æ­¢é»˜è®¤è¡Œä¸º
                event.preventDefault();
                
                try {
                    // å¼ºåˆ¶åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
                    const studentInfo = await fetchStudentInfo(true);
                    
                    if (studentInfo.username && studentInfo.studentId) {
                        console.log(`å‡†å¤‡æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å­¦ç”Ÿä¿¡æ¯: ${studentInfo.username} (${studentInfo.studentId})`);
                        
                        // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆå¦‚æœå‡½æ•°å­˜åœ¨ï¼‰
                        if (typeof window.checkSensitiveWordQuota === 'function') {
                            console.log('æ­£åœ¨æ£€æŸ¥ç”¨æˆ·çŠ¶æ€...');
                            const userAllowed = await window.checkSensitiveWordQuota();
                            
                            if (!userAllowed) {
                                console.error('ç”¨æˆ·çŠ¶æ€æ£€æŸ¥æœªé€šè¿‡ï¼Œå·²é˜»æ­¢è¯·æ±‚');
                                return; // é˜»æ­¢ç»§ç»­å¤„ç†
                            }
                            
                            console.log('ç”¨æˆ·çŠ¶æ€æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­å¤„ç†è¯·æ±‚');
                        } else {
                            console.warn('æœªæ‰¾åˆ°checkSensitiveWordQuotaå‡½æ•°ï¼Œè·³è¿‡çŠ¶æ€æ£€æŸ¥');
                        }
                    } else {
                        console.warn('æœªèƒ½è·å–å­¦ç”Ÿä¿¡æ¯ï¼Œç»§ç»­æäº¤è¯·æ±‚å¯èƒ½ä¼šå—é™');
                    }
                    
                    // ç¡®ä¿ä¿¡æ¯å·²ä¿å­˜åˆ°localStorage
                    if (studentInfo.username) localStorage.setItem('username', studentInfo.username);
                    if (studentInfo.studentId) localStorage.setItem('studentId', studentInfo.studentId);
                    
                    // ç›´æ¥è°ƒç”¨å…¨å±€generateImageå‡½æ•°
                    if (typeof window.generateImage === 'function') {
                        console.log('è°ƒç”¨å…¨å±€generateImageå‡½æ•°');
                        window.generateImage();
                    } else {
                        console.error('æ‰¾ä¸åˆ°å¯ç”¨çš„å›¾åƒç”Ÿæˆå‡½æ•°');
                        alert('ç³»ç»Ÿå‡ºé”™ï¼Œæ— æ³•ç”Ÿæˆå›¾åƒ');
                    }
                } catch (error) {
                    console.error('å¤„ç†ç”Ÿæˆè¯·æ±‚æ—¶å‡ºé”™:', error);
                    alert('ç³»ç»Ÿå‡ºé”™ï¼Œè¯·ç¨åå†è¯•');
                }
            };
            
            console.log('ç”ŸæˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶è®¾ç½®å®Œæˆ');
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–å­¦ç”Ÿä¿¡æ¯å¹¶è®¾ç½®ç”ŸæˆæŒ‰é’®
        document.addEventListener('DOMContentLoaded', function() {
            // å¼ºåˆ¶åˆ·æ–°ä¿¡æ¯ï¼Œç¡®ä¿è·å–æœ€æ–°ç”¨æˆ·
            fetchStudentInfo(true).then(info => {
                if (info.username && info.studentId) {
                    console.log(`é¡µé¢åŠ è½½å®Œæˆï¼Œå·²è·å–å­¦ç”Ÿä¿¡æ¯: ${info.username} (${info.studentId})`);
                } else {
                    console.warn('é¡µé¢åŠ è½½å®Œæˆï¼Œæœªèƒ½è·å–å­¦ç”Ÿä¿¡æ¯');
                }
                
                // è®¾ç½®ç”ŸæˆæŒ‰é’®
                setupGenerateButton();
            });
            
            // è®¾ç½®å®šæ—¶æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
            // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œçœ‹æ˜¯å¦éœ€è¦åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
            setInterval(async () => {
                try {
                    console.log('å®šæ—¶æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯...');
                    const info = await fetchStudentInfo(true);
                    
                    if (info.username && info.studentId) {
                        console.log(`å®šæ—¶æ£€æŸ¥å®Œæˆï¼Œå½“å‰ç”¨æˆ·: ${info.username} (${info.studentId})`);
                    }
                } catch (e) {
                    console.error('å®šæ—¶æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯å‡ºé”™:', e);
                }
            }, 30000);
        });
    </script>
</body>
</html> 